<!--Polymer Imports-->
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">
<!--1m2M Imports-->
<link rel="import" href="ONEm2M-chord-combo-routine.html">
<link rel="import" href="ONEm2M-chord-change-exercise.html">

<dom-module id="ONEm2M-chord-change-lesson">
  <template>
    <style>
        .practice-schedule {
          display: inline-block;
          vertical-align: top;
        }
        .exercises {
            display: inline-block;
        }
    </style>          
    <ONEm2M-chord-combo-routine id="routine" class="practice-schedule" combos="{{_combos}}" combo-count="{{exerciseCount}}" active-combo-index="{{activeExerciseIndex}}"  on-iron-select="_combosChanged"></ONEm2M-chord-combo-routine>
    <div class="exercises">
        <template is="dom-repeat" items="{{exercises}}">            
            <iron-collapse id="exerciseContainer{{item}}">        
                <ONEm2M-chord-change-exercise id="exercise{{item}}"></ONEm2M-chord-change-exercise>
            </iron-collapse>
        </template>
    </div>
  </template>

  <script>
    Polymer({
      is: 'ONEm2M-chord-change-lesson',
      properties: {
        _combos: {
            type: Array,
            notify: true,
            observer: "_combosChanged"
        },
        activeExerciseIndex: {
            type: Number,
            notify: true,
            observer: "_activeExerciseChanged"
        },
        exerciseCount: {
            type: Number,
            notify: true,
            observer: "_exerciseCountChanged"
        },
        exercises: {
            type: Array,
            value: [],
            notify: true
        }
      },
      //lifecycle callbacks
      attached: function() {
        this.exerciseCount = 5;
      },
      //_private members
      _activeExerciseChanged: function() {          
          let exercise = this.$$("#exerciseContainer" + this.activeExerciseIndex);
          if (exercise) {
              exercise.toggle();
          }        
      },
      _combosChanged: function(e) {
          if (e.path) {
            for (let i = 0; i < e.path.length; i++) {                
                console.log(e.path[i].id);
            }
          }
      },
      _exerciseCountChanged: function() {        
        this.newLesson();        
      },
      
      //public members
      newLesson: function() {        
        let exercises = [];
        for (let i=0; i < this.exerciseCount; i++) {
          exercises.push(i);
        }
        this.exercises = exercises;
        let routine = this.$.routine;
        let self = this;
        setTimeout(function() {
            for (let i=0; i< self.exerciseCount; i++) {
                let exercise = self.$$("#exercise" + i);
                if (exercise) {                    
                    exercise.chord1 = routine.combos[i].chord1;
                    exercise.chord2 = routine.combos[i].chord2;
                }
            }
        }, 1000); 
      }
    });
  </script>
</dom-module>